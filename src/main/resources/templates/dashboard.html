<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Spotify Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #121212; color: white; }
        .main-content { overflow-y: auto; height: 100vh; }
        .card { 
            background-color: #181818; border-radius: 12px; 
            transition: transform 0.2s ease-in-out; border: none; 
        }
        .card:hover { transform: scale(1.04); background-color: #282828; }
        .card-title { font-size: 0.9rem; font-weight: 600; color: white; }
        .card-text { font-size: 0.75rem; color: #b3b3b3; }
        .sidebar { position: sticky; top: 0; height: 100vh; overflow-y: auto; }
    </style>
</head>
<body class="bg-dark text-white">
    <!-- Layout Structure -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>
    
    <div class="d-flex">
        <div class="sidebar" th:replace="~{fragments/sidebar :: sidebar}"></div>

        <main class="flex-grow-1 ms-auto main-content">
            <div class="container-fluid p-4">
                <h1 class="display-6 mb-4">Welcome back, <span th:text="${user.display_name}"></span></h1>

                <!-- Top Mixes Section -->
                <section class="mb-5">
                    <h2 class="h4 mb-3">Your Top Mixes</h2>
                    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3">
                        <div class="col" th:each="mix : ${topMixes}">
                            <div class="card h-100">
                                <img th:if="${mix.images}" th:src="${mix.images[0].url}" class="card-img-top rounded" alt="Mix">
                                <div class="card-body p-2">
                                    <h5 class="card-title text-truncate mb-1" th:text="${mix.name}"></h5>
                                    <p class="card-text">Top Mix</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Recommended Section -->
                <section class="mb-5">
                    <h2 class="h4 mb-3">Recommended for Today</h2>
                    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3">
                        <div class="col" th:each="rec : ${recommendedTracks}">
                            <div class="card h-100">
                                <img th:if="${rec.album.images}" th:src="${rec.album.images[0].url}" class="card-img-top rounded" alt="Track">
                                <div class="card-body p-2">
                                    <h5 class="card-title text-truncate mb-1" th:text="${rec.name}"></h5>
                                    <p class="card-text" th:text="${rec.artists[0].name}"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Top Artists Section -->
                <section class="mb-5">
                    <h2 class="h4 mb-3">Your Top Artists</h2>
                    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3">
                        <div class="col" th:each="artist : ${topArtists}">
                            <div class="card h-100">
                                <img th:if="${artist.images}" th:src="${artist.images[0].url}" class="card-img-top rounded" alt="Artist">
                                <div class="card-body p-2">
                                    <h5 class="card-title text-truncate mb-1" th:text="${artist.name}"></h5>
                                    <p class="card-text">Artist</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Releases Section -->
                <section class="mb-5">
                    <h2 class="h4 mb-3">New Releases</h2>
                    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3">
                        <div class="col" th:each="album : ${newReleases}">
                            <div class="card h-100">
                                <img th:if="${album?.images} and ${not album.images.isEmpty()}" 
                                     th:src="${album.images[0].url}" 
                                     class="card-img-top rounded" 
                                     alt="Album Cover"
                                     onerror="this.src='https://via.placeholder.com/150'">
                                <div th:unless="${album?.images} and ${not album.images.isEmpty()}" 
                                     class="bg-secondary card-img-top rounded d-flex align-items-center justify-content-center" 
                                     style="height: 150px;">
                                    <span class="text-muted">No Cover</span>
                                </div>
                                <div class="card-body p-2">
                                    <h5 class="card-title text-truncate mb-1" th:text="${album?.name} ?: 'Unknown Album'"></h5>
                                    <p class="card-text" th:text="${#strings.listJoin(album?.artists?.[*]?.![name], ', ')} ?: 'Unknown Artist'"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Recently Played Section -->
                <section class="mb-5">
                    <h2 class="h4 mb-3">Recently Played</h2>
                    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3">
                        <!-- Content would go here -->
                    </div>
                </section>

                <!-- Playlists Section -->
                <section class="mb-5">
                    <h2 class="h4 mb-3">Your Playlists</h2>
                    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3">
                        <div class="col" th:each="playlist : ${playlists}">
                            <div class="card h-100">
                                <img th:if="${playlist.images}" th:src="${playlist.images[0].url}" class="card-img-top rounded" alt="Playlist">
                                <div class="card-body p-2">
                                    <h5 class="card-title text-truncate mb-1" th:text="${playlist.name}"></h5>
                                    <p class="card-text" th:text="${playlist.owner.display_name}"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/main.js}"></script>
</body>
</html>